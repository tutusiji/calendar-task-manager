# 项目归档功能演示

## 功能截图说明

### 1. 活跃项目列表

在 My Projects 区域，显示所有未归档的项目：

```
My Projects                    [+]
  ├─ 📌 个人事务                (置顶，无操作菜单)
  ├─ 👑 移动应用开发项目         [⋮]
  ├─ 👑 魔法世界网站             [⋮]
  └─ 产品设计项目               [⋮]
```

### 2. 项目操作菜单（创建者/管理员）

点击项目右侧的 `⋮` 按钮，显示操作菜单：

```
┌─────────────┐
│ ✏️  编辑     │
│ 📦 归档     │  ← 新增功能
│ ─────────── │
│ 🗑️  删除     │
└─────────────┘
```

### 3. 归档后的效果

点击"归档"后：
- 项目从活跃列表中移除
- 出现在"归档项目"折叠列表中
- 显示成功提示："项目已归档"

```
My Projects                    [+]
  ├─ 📌 个人事务
  ├─ 👑 魔法世界网站
  └─ 产品设计项目

📦 归档项目 (1)               [>]  ← 新增区域
```

### 4. 展开归档项目列表

点击"归档项目"展开：

```
📦 归档项目 (1)               [v]
  └─ 👑 移动应用开发项目 (半透明)  [⋮]
```

### 5. 归档项目操作菜单

点击归档项目的 `⋮` 按钮：

```
┌─────────────────┐
│ 📤 取消归档      │  ← 新增功能
│ ─────────────── │
│ 🗑️  删除         │
└─────────────────┘
```

### 6. 取消归档

点击"取消归档"后：
- 项目从归档列表移除
- 恢复到活跃项目列表
- 显示成功提示："项目已恢复"

## 交互流程图

```
┌─────────────┐
│  活跃项目    │
│  [项目A]    │
└──────┬──────┘
       │
       │ 点击"归档"
       ↓
┌─────────────┐
│  归档中...   │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│  归档项目    │
│  [项目A]    │  (半透明显示)
└──────┬──────┘
       │
       │ 点击"取消归档"
       ↓
┌─────────────┐
│  恢复中...   │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│  活跃项目    │
│  [项目A]    │
└─────────────┘
```

## 权限说明

### 可以归档项目的用户

✅ 项目创建者（显示 👑 图标）
✅ 组织创建者
✅ 超级管理员

### 不能归档项目的用户

❌ 普通项目成员（只能查看和退出）

### 特殊规则

🔒 **个人事务项目**（第一个项目）：
- 不显示操作菜单
- 无法归档
- 无法删除
- 始终置顶显示

## 技术实现要点

### 前端状态管理

```typescript
// 过滤活跃项目
const myProjects = projects
  .filter(p => p.memberIds.includes(currentUser.id) && !p.isArchived)
  .sort(...)

// 过滤归档项目
const archivedProjects = projects
  .filter(p => p.memberIds.includes(currentUser.id) && p.isArchived)
  .sort((a, b) => new Date(b.archivedAt) - new Date(a.archivedAt))
```

### API 调用

```typescript
// 归档项目
const response = await fetch(`/api/projects/${projectId}/archive`, {
  method: 'POST',
  credentials: 'include',
})

// 取消归档
const response = await fetch(`/api/projects/${projectId}/archive`, {
  method: 'DELETE',
  credentials: 'include',
})
```

### 数据库查询

```typescript
// 获取归档项目
const archivedProjects = await prisma.project.findMany({
  where: {
    organizationId: orgId,
    isArchived: true
  },
  orderBy: {
    archivedAt: 'desc'
  }
})
```

## 用户体验优化

1. **视觉反馈**
   - 归档项目显示为半透明（opacity-60）
   - 归档图标使用 📦 Archive 图标
   - 恢复图标使用 📤 ArchiveRestore 图标

2. **交互反馈**
   - 归档/取消归档操作显示 Toast 提示
   - 操作成功后自动更新列表
   - 如果正在查看被归档的项目，自动切换到 My Days

3. **列表管理**
   - 归档项目默认折叠，减少视觉干扰
   - 显示归档项目数量，方便用户了解
   - 归档项目按归档时间倒序排列

4. **权限提示**
   - 普通成员看不到归档选项
   - 只有有权限的用户才能看到归档菜单项

## 常见问题

### Q: 归档的项目还能查看吗？
A: 可以。归档只是将项目从活跃列表中移除，项目数据和任务都还在，可以正常查看。

### Q: 归档的项目可以删除吗？
A: 可以。但仍需满足"项目下无任务"的条件才能删除。

### Q: 归档的项目任务还能编辑吗？
A: 可以。归档不影响任务的正常操作，建议后续可以添加只读模式。

### Q: 个人事务项目为什么不能归档？
A: 个人事务项目是系统自动创建的默认项目，用于存放用户的个人任务，不应该被归档。

### Q: 归档项目会影响统计数据吗？
A: 不会。归档项目的任务仍然会计入统计，除非明确排除归档项目。

## 后续优化建议

1. **批量操作**：支持批量归档多个项目
2. **自动归档**：设置规则自动归档长期无活动的项目
3. **归档提醒**：归档前提醒用户项目中的任务数量
4. **只读模式**：归档项目的任务设置为只读，防止误操作
5. **归档搜索**：在归档列表中添加搜索功能
6. **归档统计**：显示归档项目的统计信息（任务数、成员数等）
